#!/bin/sh

set -e


echo "I: Add Digabi repository signing key..."
TEMPFILE="$(mktemp)"

cat > ${TEMPFILE} <<EOF
-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: GnuPG v1

mQINBFGd+iwBEADafhGwtg46hhNa1o0QGQb0B3V805GwS5K/7enLqca2QPRAR7vm
gYexCLU1+LUupSATdeT3JdB/r0VY0dc+S08Gy75Bc9elSn5kW2xuI7McuRj1IzeJ
LfmctKd1FDEDZdJfYNM/VEKTNdQJm4k3d1NJL23xF/bjbNc4u4sV/RvgKHhto6gP
ZrUfqu3/oYwfzBi9Hr76qJujsD7zhW9NuewUKlME5TxhxxWhQ+Ai0ERCwIShI22j
3Q6Z+38uuRNWCAiCjReUF/GskaUEXgFVpT9vYNYvh8a39F8uwzwM0UXasEI7t/cM
vY73vP35A3HOnxl+Kl6Cmbp6BzYTsGjz1E4NzGytOWJXjB59VtCowWlFKR+JYSbm
u9zqx1tyP7OprzhoM9xffLF3dy3yaIe227M0nxwktT1KBvuBgHsBnHnPVfkxESVl
dW8qS5QLAoqvZDGfxxrUy0F6wZ9BpIZY6cgjuV4SM5H/oHeEaFUd6BG47yWqMwrk
Wwgf0bzczNqxg97+dPsvHEbJ3NZghPAscZnEbj0G59o7Gp/JMs4O4KR5QJP2i4oF
AjzOMhuPlI1IipsLAeIRRXQop9Zt3Bos9ez0i+t261pOcJd4baGx+bmI3+hkGXPQ
yfZoQ4EBZndwoqK/koQVoXCz/2YdKg1IMN9xlpSqjeNvikVKMHPSKNfYhQARAQAB
tGhZbGlvcHBpbGFzdHV0a2ludG9sYXV0YWt1bnRhIC8gRGlnYWJpIChTaWduaW5n
IGtleSBmb3IgRGlnYWJpIHJlcG9zaXRvcnkpIDxkaWdhYmlAeWxpb3BwaWxhc3R1
dGtpbnRvLmZpPokCHAQQAQIABgUCUZ4LogAKCRA+6Ty1EcY0/ZR9D/429wabEhT7
qOM4GWBJqeiROzv738PHPWKAx0Iz1W6tapZjyMwmhIP4ieQ+KRmDwRaoLNxpaKgm
Ap6v1dR+dQJ1qCk6Hn3zFn49QAYk7/QRcfCe3kBo+pt9L5KoiuMujefsVqrWLKRF
nd8BIo3WSougaCiLCDmpBkmeCS+yAxRdymj/9Bol76j579Ka6MG9U3Osyr/5dI32
3DHHdnDAM4lVPT/XXPAVhsys0lMKQBA9Zmky61E35YSc/t4pkVhipbITS36jQHaF
ALGypS4hH/XfdR/WaQuUHPLhuiooEuAOiZYbOGC9Kh182/uMOI26ZMBetM8VJKqz
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
1TrxR7qjngY2cT8AICLQ+iWGl1f1YL6yW79Ztj0=
=d66t
-----END PGP PUBLIC KEY BLOCK-----
EOF

apt-key add ${TEMPFILE}
rm ${TEMPFILE}

cat >/etc/apt/sources.list.d/digabi.list << EOF
deb http://192.168.2.49/digabi jessie main contrib non-free
EOF

export DEBIAN_FRONTEND="noninteractive"
apt-get update

apt-get -y -o "Acquire::http::Pipeline-Depth=10" install digabi-dev ruby-dev zip npm nodejs nginx libpq-dev libnss3-tools git rsync curl unzip ruby parallel uuid-runtime netcat-traditional


